$(document).ready(function(){
  setupFireBase();

})

var image_url;
var db;
var total;
var url;
var name;

function setupFireBase() {
  var config = {
    apiKey: "AIzaSyC_RVyUP52anPVB0P0CvKtZfnzTE5Vif70",
    authDomain: "oxygenads-1e9dc.firebaseapp.com",
    databaseURL: "https://oxygenads-1e9dc.firebaseio.com",
    projectId: "oxygenads-1e9dc",
    storageBucket: "oxygenads-1e9dc.appspot.com",
    messagingSenderId: "349872546305"
  };
  firebase.initializeApp(config);
  var db = firebase.database();
  var postcount = firebase.database().ref('ads/postcount');
    postcount.on('value', function(snapshot) {
      total = snapshot.val();
      fetchData(Math.floor(Math.random() * Math.floor(total) + 1));
    });

}

function fetchData(i) {
  var ad = document.getElementById('oxygen-ad');
  var elem = document.createElement("img");
  var footer = document.createElement("div");
  footer.setAttribute("width", ad.clientWidth);

  var likecredits = document.createElement("button");

  var adrev = firebase.database().ref('ads/' + i + '/image_url/');
    adrev.on('value', function(snapshot) {
      image_url = snapshot.val();
      elem.setAttribute("src", image_url);
      elem.setAttribute("height", ad.clientHeight);
      elem.setAttribute("width", ad.clientWidth);
      ad.appendChild(elem);
      adrev = firebase.database().ref('ads/' + i + '/name/');
        adrev.on('value', function(snapshot) {
          name = snapshot.val();
          footer.innerHTML = name;
          footer.style.color = "white";

          ad.appendChild(footer);
          likecredits.classList.add("btn");
          likecredits.classList.add("white");
          likecredits.classList.add("black-text");
          adrev = firebase.database().ref('ads/' + i + '/url/');
            adrev.on('value', function(snapshot) {
                url = snapshot.val();
                var link = document.createElement("a");
                link.setAttribute('href', url);
                link.innerHTML = "More";
                link.classList.add("black-text");

                likecredits.appendChild(link);


            });

          ad.appendChild(likecredits);
        });
    });




}
